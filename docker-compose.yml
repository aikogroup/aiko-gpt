version: '3.8'

# ============================================
# ðŸš€ aikoGPT - Configuration Docker Compose
# ============================================
# 
# Commande unique pour tout lancer :
#   docker compose up --build
#
# Services :
#   - Backend (LangGraph Server) : http://localhost:2024
#   - Frontend (Next.js)         : http://localhost:3000
#
# ============================================

services:
  # ==================================
  # Backend - LangGraph Server
  # ==================================
  backend:
    build:
      context: .
      dockerfile: Dockerfile.backend
    container_name: aikogpt-backend
    ports:
      - "2024:2024"
    env_file:
      - .env
    environment:
      - PYTHONUNBUFFERED=1
      - ENVIRONMENT=development
    volumes:
      # FR: Outputs persistants
      - ./outputs:/app/outputs
      # FR: Hot reload du code backend (dev uniquement)
      - ./backend:/app/backend
      - ./prompts:/app/prompts
      - ./models:/app/models
      - ./agents:/app/agents
      - ./workflow:/app/workflow
      - ./utils:/app/utils
    networks:
      - aikogpt-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:2024/ok"]
      interval: 10s
      timeout: 5s
      retries: 5
      start_period: 30s

  # ==================================
  # Frontend - Next.js
  # ==================================
  frontend:
    build:
      context: .
      dockerfile: Dockerfile.frontend
    container_name: aikogpt-frontend
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=development
      - NEXT_PUBLIC_BACKEND_URL=http://localhost:2024
    volumes:
      # FR: Hot reload du code frontend (dev uniquement)
      - ./frontend/src:/app/src
      - ./frontend/public:/app/public
    depends_on:
      backend:
        condition: service_healthy
    networks:
      - aikogpt-network
    restart: unless-stopped

# ==================================
# Network
# ==================================
networks:
  aikogpt-network:
    driver: bridge
    name: aikogpt-network
